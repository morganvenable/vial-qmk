name: Release QMK Firmware

on:
  push:
    tags:
      - 'v*'
  pull_request_target:
    types: [opened, synchronize, reopened]


permissions: write-all

jobs:
  build:
    uses: ./.github/workflows/build-firmware.yml
    with:
      keyboard: ${{ matrix.keyboard }}
      keymap: ${{ matrix.keymap }}
      side: ${{ matrix.side }}
      POINTING_DEVICE_DRIVER: ${{ matrix.POINTING_DEVICE_DRIVER}}
    strategy:
      matrix:
        keyboard: [ svalboard/trackpoint, svalboard, svalboard/trackball, svalboard/trackball ]
        keymap: [ vial ]
        side: [ left, right ]
        POINTING_DEVICE_DRIVER: [ null, null, pmw3360, pmw3389 ]
